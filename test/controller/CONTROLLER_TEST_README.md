# 瑞眼灵巧手控制器测试程序

## 概述

`test_controller.py` 是一个完整的瑞眼灵巧手控制器测试程序，提供了交互式控制界面和自动化测试功能。

## 功能特性

### 1. 设备连接管理
- 自动连接/断开RS485设备
- 连接状态监控
- 错误处理和重连机制

### 2. 电机控制
- **位置控制**: 直接设置电机位置值 (0-4095)
- **角度控制**: 通过角度设置电机位置 (0-180°)
- **速度控制**: 设置电机运动速度
- **电流限制**: 设置电机电流限制

### 3. 状态监控
- 实时读取电机状态
- 位置、角度、速度、电流信息显示
- 电机故障状态检测
- 后台监控模式

### 4. 交互式控制界面
- 命令行交互界面
- 多种控制命令
- 实时状态显示
- 自动化测试功能

## 使用方法

### 1. 基本使用

```bash
# 进入测试目录
cd /root/workspace/src/ruiyan_hand_driver/test/controller

# 运行测试程序
python3 test_controller.py
```

### 2. 交互式命令

程序启动后，可以使用以下命令：

#### 状态查询
```
status    # 显示所有电机当前状态
```

#### 位置控制
```
move 2048 2048 2048 2048 2048 2048    # 设置6个电机到中间位置
move 1000 1000 1000 1000 1000 1000    # 设置6个电机到低位置
move 3000 3000 3000 3000 3000 3000    # 设置6个电机到高位置
```

#### 角度控制
```
angle 90 90 90 90 90 90      # 设置6个电机到90度
angle 45 45 45 45 45 45      # 设置6个电机到45度
angle 135 135 135 135 135 135 # 设置6个电机到135度
```

#### 故障处理
```
clear    # 清除所有电机故障
```

#### 状态监控
```
monitor 1.0    # 开始状态监控，每1秒更新一次
monitor 0.5    # 开始状态监控，每0.5秒更新一次
stop           # 停止状态监控
```

#### 自动化测试
```
test    # 运行完整的自动化测试序列
```

#### 退出程序
```
quit    # 退出程序
q       # 退出程序（简写）
```

### 3. 程序化使用

```python
from test_controller import RuiyanHandTester

# 使用上下文管理器
with RuiyanHandTester() as tester:
    # 显示状态
    tester.print_motor_status()
    
    # 控制电机
    tester.move_motors([2048, 2048, 2048, 2048, 2048, 2048])
    
    # 通过角度控制
    tester.move_motors_by_angles([90, 90, 90, 90, 90, 90])
    
    # 清除故障
    tester.clear_motor_errors()
```

## 配置参数

### 默认配置
- **端口**: `/dev/ttyACM0`
- **波特率**: `115200`
- **电机ID**: `[1, 2, 3, 4, 5, 6]`
- **超时时间**: `0.1秒`

### 自定义配置
```python
# 创建自定义配置的测试器
tester = RuiyanHandTester(
    port='/dev/ttyUSB0',           # 自定义端口
    baudrate=9600,                 # 自定义波特率
    motor_ids=[1, 2, 3, 4, 5, 6]  # 自定义电机ID
)
```

## 状态信息说明

### 电机状态显示
```
电机1: 位置=2048 | 角度= 90.00° | 速度=   0 | 电流=   0mA | 状态=电机正常
电机2: 位置=2048 | 角度= 90.00° | 速度=   0 | 电流=   0mA | 状态=电机正常
...
```

### 状态字段说明
- **位置**: 电机当前位置值 (0-4095)
- **角度**: 对应的角度值 (0-180°)
- **速度**: 电机当前速度
- **电流**: 电机当前电流 (mA)
- **状态**: 电机运行状态描述

## 自动化测试序列

运行 `test` 命令会执行以下测试：

1. **清除故障测试**: 发送清除故障命令
2. **状态读取测试**: 读取并显示电机状态
3. **位置控制测试**: 
   - 中间位置 (2048)
   - 低位置 (1000)
   - 高位置 (3000)
   - 回到中间位置
4. **角度控制测试**:
   - 90度
   - 45度
   - 135度
   - 回到90度

## 错误处理

### 常见错误及解决方案

1. **权限错误**
   ```
   错误: 没有访问/dev/ttyACM0的权限
   解决: sudo chmod 666 /dev/ttyACM0
   ```

2. **设备连接失败**
   ```
   错误: 设备连接失败
   解决: 检查设备是否连接，端口是否正确
   ```

3. **参数数量错误**
   ```
   错误: 需要6个位置值 (0-4095)
   解决: 确保提供6个电机的位置值
   ```

4. **数值范围错误**
   ```
   错误: 位置值必须是整数
   解决: 确保位置值在0-4095范围内
   ```

## 注意事项

1. **安全操作**: 确保灵巧手周围没有障碍物
2. **参数范围**: 位置值范围0-4095，角度值范围0-180°
3. **连接稳定**: 保持RS485连接稳定
4. **监控状态**: 定期检查电机状态，注意异常情况
5. **故障处理**: 出现故障时及时使用 `clear` 命令清除

## 扩展功能

### 添加自定义测试
```python
def custom_test(self):
    """自定义测试函数"""
    # 添加您的测试逻辑
    pass
```

### 集成到其他程序
```python
# 在其他Python程序中导入使用
from test_controller import RuiyanHandTester

# 创建控制器实例
controller = RuiyanHandTester()
controller.connect()

# 执行控制操作
controller.move_motors_by_angles([90, 90, 90, 90, 90, 90])

# 断开连接
controller.disconnect()
```

## 技术支持

如果遇到问题，请检查：
1. 设备连接是否正常
2. 权限设置是否正确
3. 参数值是否在有效范围内
4. 查看日志输出获取详细错误信息

